<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>YouTube Music Player</title>
</head>
<body>
<h1>YouTube Music Player</h1>

<input type="text" id="query" placeholder="Song, genre, or playlist link" size="50" />
<select id="mode">
  <option value="song">Song</option>
  <option value="genre">Genre</option>
  <option value="playlist">Playlist</option>
</select>
<button onclick="fetchAndPlay()">Play</button>

<audio id="player" controls></audio>

<script>
async function fetchAndPlay() {
  const mode = document.getElementById('mode').value;
  const query = encodeURIComponent(document.getElementById('query').value);
  if (!query) {
    alert('Enter a search or playlist URL');
    return;
  }
  const url = `/stream?mode=${mode}&query=${query}`;
  console.log("Requesting:", url);

  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error("Network response was not ok");
    const audioBlob = await response.blob();
    const audioUrl = URL.createObjectURL(audioBlob);
    const player = document.getElementById('player');
    player.src = audioUrl;
    player.play();
  } catch (e) {
    alert("Failed to load audio: " + e.message);
  }
}
</script>
</body>
</html>
